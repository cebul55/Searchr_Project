{% extends 'searchr_app/base.html' %}
{% load staticfiles %}

{% block title_block %}
    {% if search and user.is_authenticated %}
        {{ search.title }}
    {% else %}
        Unknown Search
    {% endif %}
{% endblock %}

{% block body_block %}
    <div class="jumbotron p-4">
        <div class="container">
            {% if search and user.is_authenticated %}
                <nav aria-label="breadcrumb p-1">
                    <ol class="breadcrumb p-lg-0">
                        <li class="breadcrumb-item"><a href="{% url 'searchr_app:home' %}">Home</a> </li>
                        <li class="breadcrumb-item"><a href="{% url 'searchr_app:show_project' project.user.username project.slug %}">{{ project.title }}</a></li>
                        <li class="breadcrumb-item active"><a href="#">{{ search.title }}</a> </li>
                    </ol>
                </nav>
                <h1 class="jumbotron-heading text-center">{{ search.title }}</h1>
                <h3 class="jumbotron-content text-left">Status: {{ search.status|capfirst}}</h3>
            {% else %}
                <h1 class="jumbotron-heading">Specified Search does not exist or you are not logged in.</h1>
            {% endif %}
        </div>
    </div>

    {% if search %}

        Title: {{ search.title }}<br/>
        Project: {{ search.project }}<br/>
        SearchEngine: {{ search.search_engine }}<br/>
        Exact Query: {{ search.query }}<br/>
        Date created: {{ search.date_created }}<br/>

        {% if phrases %}
            <h3 class="jumbotron-heading text-center">Defined Phrases: </h3>
            {% for phrase in phrases %}
                <li class="jumbotron-fluid text-center text-body">
                    {{ phrase }}
                </li>
            {% endfor %}
            {% if search.status != 'running' %}
                <form action="{% url 'searchr_app:run_query' search.id %}" method="post">
                    {% csrf_token %}
                    <div class="btn-group">
                        <button class="btn-primary btn" type="submit" name="submit" >Run Search</button>
                        <button class="btn btn-dark" type="button" name="delete">Delete</button>
                    </div>
                </form>
            {% else %}
                <div class="container">
                    <h3 class="jumbotron-heading text-body">
                        Search is running. {{ search.running_results }} search results are still processed.
                    </h3>

                    <form action="{% url 'searchr_app:run_query' search.id %}" method="post">
                        {% csrf_token %}
                        <button class="btn-primary btn" type="submit" name="submit" disabled="disabled">Run Search</button>

                    </form>
                </div>
            {% endif %}
{#            <a class="btn-primary btn" method="post" href="{% url 'searchr_app:run_query' search.id %}">Run Search</a>#}
        {% else %}
            <h3 class="jumbotron-heading text-center">No defined phrases add one to start searching</h3>
        {% endif %}

        {% if search_results %}
            <div class="container">
                <div class="row align-items-center">
                    <div class="col-md-12">
                        <div class="card mb-4">
                            <div class="card-header" style="background-color: #80bdff;">
                                <h3 class="jumbotron-heading text-center" >Search Results:</h3>
                            </div>
                            <div class="card-body p-2">
                                <ul class="list-group p-0">
                                    {% for search_result in search_results %}
                                        {% if search_result.status == 'finished'  %}
                                        <li class="list-group-item card p-0">
                                            <div class="card-header" >
                                                <a class="card-link" href="{% url 'searchr_app:search_result' search_result.id %}">{{ search_result.title|safe|escape  }}</a>

                                            </div>
                                            <div class="card-body p-3">
                                                <p style="background-color: red">TODO URL GO TO</p>
                                                URL: <a class="card-link" href="{{ search_result.url }}">{{ search_result.url }}</a><br/>
                                                Date found: {{ search_result.date_found }}<br/>
                                                Accuracy: {{ search_result.accuracy }} %
                                            </div>
                                        </li>
                                        {% endif %}
                                    {% endfor %}
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

        {% else %}
            <div class="container">
                <div class="row align-items-center">
                    <div class="col-md-12">
                        <div class="card mb-4">
                            <div class="card-header">
                                <h3 class="jumbotron-heading text-center">No Search Results<br/>Try searchin again.</h3>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        {% endif %}
    {% endif %}
{%  endblock %}